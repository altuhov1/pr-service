# PR Reviewer Assignment Service

Микросервис для автоматического назначения ревьюверов на Pull Request’ы с управлением командами, активностью пользователей и поддержкой переназначения ревьюверов.

---

## Основные возможности

- **Работа с pr и конмадами** — сооздание конмад, создание pr с автоматическим назначением проверяющих, замена одного ревьювера на другого из его команды, MERGE, корректировка активности юрезров
- **Восстановление после сбоев** — все операции — транзакционные, с retry-логикой для `SERIALIZABLE`  
- **Быстрое тестирование и deploy**: интеграционные тесты через testcontainers-go для всего пакета storage, E2E-тесты через `curl`, поднятие через docker-compose

---

### Инфраструктура

- **Docker** — контейнеризация всех сервисов
- **Docker Compose** — оркестрация: Go-бэкенд, PostgreSQL, Caddy

---

## Архитектура

- **Архитектурный стиль** — взаимодействие через REST API
- **Модульная структура**: `handlers`, `services`, `storage` — разделение ответственности для удобства тестирования, поддержки и понимания кода
- **Долговременное хранение**: PostgreSQL с индексами, все состанвые мутации выполняются в транзакциях 
- **Caddy**: выступает обратным прокси с JSON-логированием, сжатием ответов и обработкой ошибок.

---

## API

| Эндпоинт                          | Метод | Описание                                      |
|-----------------------------------|-------|------------------------------------------------|
| `/team/add`                       | POST  | Создаёт команду с участниками                  |
| `/team/get`                       | GET   | Возвращает команду с участниками               |
| `/users/setIsActive`              | POST  | Устанавливает флаг активности пользователя     |
| `/users/getReview`                | GET   | Возвращает список PR’ов, где пользователь — ревьювер |
| `/pullRequest/create`             | POST  | Создаёт PR и назначает ревьюверов              |
| `/pullRequest/merge`              | POST  | Помечает PR как `MERGED` (идемпотентно)        |
| `/pullRequest/reassign`           | POST  | Переназначает одного ревьювера на другого      |

----

## Запуск
```bash
cp .env.example .env

docker compose up --build 
```

----

## Тестирование
```bash
make e2e 

make test 
```

----

## Сетевые логи
```bash
docker logs -f test-task-caddy-1
```